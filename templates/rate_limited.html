{% extends "base.html" %}

{% block title %}–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤{% endblock %}

{% block header %}‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤{% endblock %}

{% block content %}
<div class="rate-limit-container">
    <div class="rate-limit-icon">‚ö†Ô∏è</div>
    
    <h2>–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
    
    <div class="limit-info">
        <div class="info-item">
            <span class="info-label">–¢–∏–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</span>
            <span class="info-value">{{ limit_type }}</span>
        </div>
        
        <div class="info-item">
            <span class="info-label">–°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞:</span>
            <span class="info-value" id="resetAt">{{ reset_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
        </div>
        
        {% if blocked %}
        <div class="info-item warning">
            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
            <span class="info-value">IP –∞–¥—Ä–µ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
        </div>
        {% endif %}
    </div>
    
    <div class="countdown-container">
        <h3>–í—Ä–µ–º—è –¥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞:</h3>
        <div class="countdown" id="countdown">
            <div class="countdown-item">
                <span class="countdown-number" id="minutes">00</span>
                <span class="countdown-label">–º–∏–Ω—É—Ç</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="seconds">00</span>
                <span class="countdown-label">—Å–µ–∫—É–Ω–¥</span>
            </div>
        </div>
    </div>
    
    <div class="explanation-section">
        <h3>–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?</h3>
        <div class="explanation-content">
            {% if limit_type == 'login' %}
            <p>–í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É. –≠—Ç–æ –º–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫.</p>
            <ul>
                <li>–ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –∑–∞ 5 –º–∏–Ω—É—Ç</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞</li>
            </ul>
            {% elif limit_type == 'api_general' %}
            <p>–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤. –ó–∞–º–µ–¥–ª–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ API.</p>
            <ul>
                <li>–ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
                <li>–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤</li>
            </ul>
            {% elif limit_type == 'password_change' %}
            <p>–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è. –≠—Ç–æ –º–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</p>
            <ul>
                <li>–ú–∞–∫—Å–∏–º—É–º 3 —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –≤ —á–∞—Å</li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞</li>
            </ul>
            {% else %}
            <p>–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π.</p>
            <ul>
                <li>–ó–∞–º–µ–¥–ª–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞</li>
                <li>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
            </ul>
            {% endif %}
        </div>
    </div>
    
    <div class="actions-section">
        <button onclick="checkLimit()" class="btn btn-primary" id="checkBtn">
            üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç
        </button>
        
        {% if not blocked %}
        <button onclick="goBack()" class="btn btn-secondary">
            ‚Ü©Ô∏è –ù–∞–∑–∞–¥
        </button>
        {% endif %}
        
        <a href="{{ url_for('index') }}" class="btn btn-info">
            üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
    
    {% if blocked %}
    <div class="blocked-warning">
        <h3>üö´ IP –∞–¥—Ä–µ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h3>
        <p>–ò–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –≤–∞—à IP –∞–¥—Ä–µ—Å –±—ã–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±—É–¥–µ—Ç —Å–Ω—è—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
    </div>
    {% endif %}
</div>

<script>
// –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –¥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞
const resetAt = new Date('{{ reset_at.isoformat() }}').getTime();

function updateCountdown() {
    const now = new Date().getTime();
    const timeLeft = resetAt - now;
    
    if (timeLeft <= 0) {
        document.getElementById('countdown').innerHTML = '<div class="countdown-expired">–õ–∏–º–∏—Ç —Å–±—Ä–æ—à–µ–Ω! –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</div>';
        document.getElementById('checkBtn').textContent = '‚úÖ –õ–∏–º–∏—Ç —Å–±—Ä–æ—à–µ–Ω';
        document.getElementById('checkBtn').classList.remove('btn-primary');
        document.getElementById('checkBtn').classList.add('btn-success');
        return;
    }
    
    const minutes = Math.floor(timeLeft / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
}

function checkLimit() {
    const now = new Date().getTime();
    if (resetAt <= now) {
        location.reload();
    } else {
        showNotification('–õ–∏–º–∏—Ç –µ—â–µ –Ω–µ —Å–±—Ä–æ—à–µ–Ω. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.', 'warning');
    }
}

function goBack() {
    if (window.history.length > 1) {
        window.history.back();
    } else {
        window.location.href = '/';
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(updateCountdown, 1000);
updateCountdown();
</script>

<style>
.rate-limit-container {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
    padding: 40px 20px;
}

.rate-limit-icon {
    font-size: 80px;
    margin-bottom: 30px;
    opacity: 0.8;
}

.rate-limit-container h2 {
    color: var(--warning-color);
    margin-bottom: 30px;
    font-size: 28px;
}

.limit-info {
    background: var(--bg-tertiary);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 30px;
    text-align: left;
}

.info-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.info-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.info-item.warning {
    background: var(--warning-bg);
    padding: 10px;
    border-radius: 6px;
    border: none;
}

.info-label {
    font-weight: bold;
    color: var(--text-secondary);
}

.info-value {
    color: var(--text-primary);
    font-family: monospace;
}

.countdown-container {
    margin-bottom: 40px;
}

.countdown-container h3 {
    margin-bottom: 20px;
    color: var(--text-primary);
}

.countdown {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
}

.countdown-item {
    background: var(--bg-tertiary);
    border-radius: 12px;
    padding: 20px;
    min-width: 80px;
}

.countdown-number {
    display: block;
    font-size: 32px;
    font-weight: bold;
    color: var(--warning-color);
    margin-bottom: 5px;
}

.countdown-label {
    font-size: 14px;
    color: var(--text-secondary);
}

.countdown-expired {
    background: var(--success-bg);
    color: var(--success-color);
    padding: 20px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 18px;
}

.explanation-section {
    background: var(--bg-tertiary);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 30px;
    text-align: left;
}

.explanation-section h3 {
    margin-bottom: 15px;
    color: var(--text-primary);
}

.explanation-content p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 15px;
}

.explanation-content ul {
    list-style-position: inside;
    color: var(--text-secondary);
}

.explanation-content li {
    margin-bottom: 8px;
}

.actions-section {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 30px;
}

.blocked-warning {
    background: var(--danger-bg);
    border: 2px solid var(--danger-color);
    border-radius: 12px;
    padding: 25px;
    text-align: left;
}

.blocked-warning h3 {
    color: var(--danger-color);
    margin-bottom: 15px;
}

.blocked-warning p {
    color: var(--danger-color);
    line-height: 1.6;
}

@media (max-width: 768px) {
    .rate-limit-container {
        padding: 20px 10px;
    }
    
    .rate-limit-icon {
        font-size: 60px;
    }
    
    .rate-limit-container h2 {
        font-size: 24px;
    }
    
    .countdown {
        flex-direction: row;
        justify-content: center;
    }
    
    .countdown-item {
        min-width: 70px;
        padding: 15px;
    }
    
    .countdown-number {
        font-size: 24px;
    }
    
    .info-item {
        flex-direction: column;
        gap: 5px;
    }
    
    .actions-section {
        flex-direction: column;
        align-items: center;
    }
    
    .actions-section .btn {
        width: 100%;
        max-width: 250px;
    }
}
</style>
{% endblock %}