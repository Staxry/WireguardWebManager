{% extends "base.html" %}

{% block title %}–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ {{ client_name }}{% endblock %}

{% block header %}üìÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞: {{ client_name }}{% endblock %}

{% block content %}
<div class="config-container">
    <div class="config-actions">
        <button onclick="copyConfig()" class="btn btn-primary">
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        </button>
        <button onclick="downloadConfig()" class="btn btn-success">
            üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
        </button>
        <a href="{{ url_for('qr_client_config_by_name', client_name=client_name) if client_name else '#' }}" class="btn btn-info">
            üì± QR-–∫–æ–¥
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            ‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
        </a>
    </div>

    <div class="config-display">
        <div class="config-header">
            <h3>üîß –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h3>
            {% if config_file %}
            <small>üìÅ –°–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫: <code>{{ config_file }}</code></small>
            {% endif %}
        </div>
        
        <textarea id="config-text" readonly>{{ client_config }}</textarea>
    </div>

    <div class="instructions">
        <h3>üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é</h3>
        
        <div class="instruction-tabs">
            <button class="tab-btn active" onclick="showTab('android')">ü§ñ Android</button>
            <button class="tab-btn" onclick="showTab('ios')">üçé iOS</button>
            <button class="tab-btn" onclick="showTab('windows')">ü™ü Windows</button>
            <button class="tab-btn" onclick="showTab('linux')">üêß Linux</button>
        </div>

        <div id="android" class="tab-content active">
            <h4>Android (WireGuard –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)</h4>
            <ol>
                <li>üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <strong>WireGuard</strong> –∏–∑ Google Play</li>
                <li>üì± –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"QR-–∫–æ–¥"</strong> –≤—ã—à–µ</li>
                <li>üì∑ –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ <strong>"+"</strong> ‚Üí <strong>"–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥"</strong></li>
                <li>üîó –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ —Å —ç–∫—Ä–∞–Ω–∞</li>
                <li>‚úÖ –ù–∞–∂–º–∏—Ç–µ <strong>"–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"</strong></li>
            </ol>
        </div>

        <div id="ios" class="tab-content">
            <h4>iOS (WireGuard –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)</h4>
            <ol>
                <li>üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <strong>WireGuard</strong> –∏–∑ App Store</li>
                <li>üì± –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"QR-–∫–æ–¥"</strong> –≤—ã—à–µ</li>
                <li>üì∑ –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ <strong>"+"</strong> ‚Üí <strong>"–°–æ–∑–¥–∞—Ç—å –∏–∑ QR-–∫–æ–¥–∞"</strong></li>
                <li>üîó –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ —Å —ç–∫—Ä–∞–Ω–∞</li>
                <li>‚úÖ –ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</strong> –∏ –∑–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å</li>
            </ol>
        </div>

        <div id="windows" class="tab-content">
            <h4>Windows (WireGuard –∫–ª–∏–µ–Ω—Ç)</h4>
            <ol>
                <li>üì• –°–∫–∞—á–∞–π—Ç–µ <strong>WireGuard</strong> —Å <a href="https://www.wireguard.com/install/" target="_blank">–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞</a></li>
                <li>üíæ –ù–∞–∂–º–∏—Ç–µ <strong>"–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª"</strong> –≤—ã—à–µ</li>
                <li>üìÇ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª <code>{{ client_name }}.conf</code></li>
                <li>‚ûï –í WireGuard –Ω–∞–∂–º–∏—Ç–µ <strong>"–î–æ–±–∞–≤–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å"</strong> ‚Üí <strong>"–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞"</strong></li>
                <li>üìÅ –í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª</li>
                <li>‚úÖ –ù–∞–∂–º–∏—Ç–µ <strong>"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"</strong></li>
            </ol>
        </div>

        <div id="linux" class="tab-content">
            <h4>Linux (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)</h4>
            <ol>
                <li>üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WireGuard: <code>sudo apt install wireguard</code></li>
                <li>üíæ –ù–∞–∂–º–∏—Ç–µ <strong>"–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª"</strong> –≤—ã—à–µ</li>
                <li>üìÇ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∫–∞–∫ <code>/etc/wireguard/{{ client_name }}.conf</code></li>
                <li>üîß –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞: <code>sudo chmod 600 /etc/wireguard/{{ client_name }}.conf</code></li>
                <li>üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–µ: <code>sudo wg-quick up {{ client_name }}</code></li>
                <li>üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞: <code>sudo wg-quick down {{ client_name }}</code></li>
            </ol>
        </div>
    </div>

    <div class="security-notice">
        <h3>üîí –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
        <ul>
            <li>üîê <strong>–ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–º –∫–∞–Ω–∞–ª–∞–º</strong> (email, SMS, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã)</li>
            <li>üóëÔ∏è <strong>–£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</strong> –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</li>
            <li>üë• <strong>–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</strong> –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</li>
            <li>üîÑ <strong>–ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏</strong> –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
        </ul>
    </div>
</div>

<script>
function copyConfig() {
    const configText = document.getElementById('config-text');
    configText.select();
    configText.setSelectionRange(0, 99999); // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    
    try {
        document.execCommand('copy');
        showNotification('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    } catch (err) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.', 'error');
    }
}

function downloadConfig() {
    const configText = document.getElementById('config-text').value;
    const blob = new Blob([configText], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '{{ client_name }}.conf';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    showNotification('üì• –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∫–∞—á–∞–Ω!', 'success');
}

function showTab(tabName) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => content.classList.remove('active'));
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –∫–Ω–æ–ø–æ–∫
    const buttons = document.querySelectorAll('.tab-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    setTimeout(() => notification.classList.add('show'), 100);
    
    // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => document.body.removeChild(notification), 300);
    }, 3000);
}
</script>

<style>
.config-container {
    max-width: 800px;
    margin: 0 auto;
}

.config-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-align: center;
}

.btn-primary { background-color: var(--primary-color); color: white; }
.btn-success { background-color: var(--success-color); color: white; }
.btn-info { background-color: var(--info-color); color: white; }
.btn-secondary { background-color: var(--text-secondary); color: white; }

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.config-display {
    background: var(--bg-secondary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
}

.config-header {
    margin-bottom: 15px;
}

.config-header h3 {
    margin: 0 0 5px 0;
    color: var(--text-primary);
}

.config-header small {
    color: var(--text-secondary);
}

.config-header code {
    background: var(--bg-tertiary);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    color: var(--text-primary);
}

#config-text {
    width: 100%;
    height: 300px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    padding: 15px;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    resize: vertical;
}

.instructions {
    background: var(--bg-secondary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
}

.instruction-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.tab-btn {
    padding: 10px 20px;
    border: none;
    background: none;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
    font-weight: bold;
    color: var(--text-primary);
}

.tab-btn.active {
    border-bottom-color: var(--primary-color);
    color: var(--primary-color);
}

.tab-btn:hover {
    background: var(--bg-tertiary);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-content h4 {
    color: #333;
    margin-bottom: 15px;
}

.tab-content ol {
    padding-left: 20px;
}

.tab-content li {
    margin-bottom: 10px;
    line-height: 1.5;
}

.tab-content code {
    background: #f8f9fa;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
}

.tab-content a {
    color: #007bff;
    text-decoration: none;
}

.tab-content a:hover {
    text-decoration: underline;
}

.security-notice {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}

.security-notice h3 {
    color: #856404;
    margin-top: 0;
}

.security-notice ul {
    margin: 15px 0 0 0;
    padding-left: 20px;
}

.security-notice li {
    margin-bottom: 10px;
    line-height: 1.5;
    color: #856404;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    z-index: 1000;
    transform: translateX(400px);
    transition: transform 0.3s ease;
}

.notification.success {
    background-color: #28a745;
}

.notification.error {
    background-color: #dc3545;
}

.notification.show {
    transform: translateX(0);
}

@media (max-width: 768px) {
    .config-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 300px;
    }
    
    .instruction-tabs {
        flex-wrap: wrap;
    }
    
    .tab-btn {
        flex: 1;
        min-width: 80px;
        font-size: 12px;
        padding: 8px 10px;
    }
}
</style>
{% endblock %}