{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏{% endblock %}

{% block header %}‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-grid">
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é -->
        <div class="settings-section">
            <div class="section-header">
                <h3>üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é</h3>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
            </div>
            
            <div class="settings-options">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">üîê</div>
                        <div class="setting-details">
                            <h4>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h4>
                            <p>–û–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                        </div>
                    </div>
                    <div class="setting-action">
                        <a href="{{ url_for('change_password') }}" class="btn btn-primary">
                            –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </a>
                    </div>
                </div>
                
                {% if security_enabled %}
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">üë§</div>
                        <div class="setting-details">
                            <h4>–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                            <p>–û–±–Ω–æ–≤–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                        </div>
                    </div>
                    <div class="setting-action">
                        <a href="{{ url_for('change_username') }}" class="btn btn-primary">
                            –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è
                        </a>
                    </div>
                </div>
                {% else %}
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">üë§</div>
                        <div class="setting-details">
                            <h4>–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                            <p>–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –±–∞–∑–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</p>
                        </div>
                    </div>
                    <div class="setting-action">
                        <span class="btn btn-disabled">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏ -->
        <div class="settings-section">
            <div class="section-header">
                <h3>üîí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏</h3>
                <p>–¢–µ–∫—É—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–π —Å–µ—Å—Å–∏–∏</p>
            </div>
            
            <div class="session-info">
                <div class="info-item">
                    <span class="info-label">üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                    <span class="info-value">{{ session_info.username }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üïê –í—Ä–µ–º—è –≤—Ö–æ–¥–∞:</span>
                    <span class="info-value">
                        {% if session_info.login_time %}
                            {{ session_info.login_time[:16]|replace('T', ' ') }}
                        {% else %}
                            –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                        {% endif %}
                    </span>
                </div>
                
                {% if security_enabled %}
                <div class="info-item">
                    <span class="info-label">‚è±Ô∏è –¢–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏:</span>
                    <span class="info-value">{{ session_info.timeout_minutes }} –º–∏–Ω—É—Ç</span>
                </div>
                {% endif %}
                
                <div class="info-item">
                    <span class="info-label">üõ°Ô∏è –†–µ–∂–∏–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</span>
                    <span class="info-value">
                        {% if security_enabled %}
                            <span class="status-enabled">‚úÖ –í–∫–ª—é—á–µ–Ω</span>
                        {% else %}
                            <span class="status-disabled">‚ö†Ô∏è –ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="settings-section">
            <div class="section-header">
                <h3>üñ•Ô∏è –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</p>
            </div>
            
            <div class="system-info">
                <div class="info-item">
                    <span class="info-label">üåê WireGuard –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:</span>
                    <span class="info-value">{{ interface_name }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</span>
                    <span class="info-value">
                        {% if interface_active %}
                            <span class="status-enabled">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                            <span class="status-disabled">‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üîß –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</span>
                    <span class="info-value">WireGuard Web Management v2.0</span>
                </div>
            </div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="settings-section">
            <div class="section-header">
                <h3>üîß –î–µ–π—Å—Ç–≤–∏—è</h3>
                <p>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã</p>
            </div>
            
            <div class="actions-grid">
                <a href="{{ url_for('dashboard') }}" class="action-card">
                    <div class="action-icon">üìä</div>
                    <div class="action-content">
                        <h4>Dashboard</h4>
                        <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
                    </div>
                </a>

                <!-- –î–µ–π—Å—Ç–≤–∏—è —Å wg0 –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ, —Å–∫—Ä—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
                {# 
                <form action="{{ url_for('cleanup_orphans') }}" method="post" class="action-card" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ wg0.conf? –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø.');">
                    <div class="action-icon">üßπ</div>
                    <div class="action-content">
                        <h4>–û—á–∏—Å—Ç–∏—Ç—å –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö</h4>
                        <p>–°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –∏ —É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ [Peer] –∏–∑ wg0</p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top:10px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </form>

                <form action="{{ url_for('restore_last_backup') }}" method="post" class="action-card" onsubmit="return confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø wg0.conf?');">
                    <div class="action-icon">üóÇÔ∏è</div>
                    <div class="action-content">
                        <h4>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—ç–∫–∞–ø</h4>
                        <p>–í–µ—Ä–Ω—É—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–æ–ø–∏—é wg0.conf</p>
                    </div>
                    <button type="submit" class="btn btn-secondary" style="margin-top:10px;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </form>
                #}
                
                <a href="{{ url_for('logout') }}" class="action-card logout-card">
                    <div class="action-icon">üö™</div>
                    <div class="action-content">
                        <h4>–í—ã–π—Ç–∏</h4>
                        <p>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.settings-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
}

.settings-section {
    background: var(--bg-secondary);
    border-radius: 12px;
    box-shadow: var(--shadow);
    overflow: hidden;
}

.section-header {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    padding: 25px;
    text-align: center;
}

.section-header h3 {
    margin: 0 0 10px 0;
    font-size: 1.4em;
}

.section-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 0.95em;
}

.settings-options {
    padding: 25px;
}

.setting-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border: 2px solid #f8f9fa;
    border-radius: 8px;
    margin-bottom: 15px;
    transition: all 0.3s;
}

.setting-item:hover {
    border-color: #007bff;
    background: #f8f9fa;
}

.setting-info {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
}

.setting-icon {
    font-size: 24px;
    width: 40px;
    text-align: center;
}

.setting-details h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.setting-details p {
    margin: 0;
    color: #666;
    font-size: 0.9em;
}

.setting-action .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
    transform: translateY(-1px);
}

.btn-disabled {
    background-color: #6c757d;
    color: white;
    cursor: not-allowed;
    opacity: 0.6;
}

.session-info,
.system-info {
    padding: 25px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: bold;
    color: #333;
}

.info-value {
    color: #666;
}

.status-enabled {
    color: #28a745;
    font-weight: bold;
}

.status-disabled {
    color: #dc3545;
    font-weight: bold;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    padding: 25px;
}

.action-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    border: 2px solid #f8f9fa;
    border-radius: 8px;
    text-decoration: none;
    color: #333;
    transition: all 0.3s;
    text-align: center;
}

.action-card:hover {
    border-color: #007bff;
    background: #f8f9fa;
    transform: translateY(-2px);
}

.logout-card:hover {
    border-color: #dc3545;
    background: #fff5f5;
}

.action-icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.action-content h4 {
    margin: 0 0 5px 0;
    font-size: 1.1em;
}

.action-content p {
    margin: 0;
    font-size: 0.9em;
    color: #666;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
[data-theme="dark"] .settings-section {
    background: var(--bg-secondary);
}

[data-theme="dark"] .setting-item {
    border-color: var(--border-color);
}

[data-theme="dark"] .setting-item:hover {
    border-color: var(--primary-color);
    background: var(--bg-tertiary);
}

[data-theme="dark"] .setting-details h4,
[data-theme="dark"] .info-label,
[data-theme="dark"] .action-card {
    color: var(--text-primary);
}

[data-theme="dark"] .setting-details p,
[data-theme="dark"] .info-value,
[data-theme="dark"] .action-content p {
    color: var(--text-secondary);
}

[data-theme="dark"] .info-item {
    border-bottom-color: var(--border-color);
}

[data-theme="dark"] .action-card {
    border-color: var(--border-color);
}

[data-theme="dark"] .action-card:hover {
    border-color: var(--primary-color);
    background: var(--bg-tertiary);
}

[data-theme="dark"] .logout-card:hover {
    border-color: #dc3545;
    background: #2c0b0e;
}

@media (max-width: 768px) {
    .settings-container {
        padding: 15px;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .setting-item {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .setting-info {
        flex-direction: column;
        text-align: center;
    }
    
    .info-item {
        flex-direction: column;
        gap: 5px;
        text-align: center;
    }
}
</style>
{% endblock %}